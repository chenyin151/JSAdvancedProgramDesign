<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>XMLHttpRequest对象</title>
</head>
<body>
    <script>
        // 创建兼容性较好的XHR对象
        function createXHR(){
            console.log('createXHR');
            if (typeof XMLHttpRequest != 'undefined') {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject != 'undefined') {
                if (typeof ActiveXObject != 'undefined') {
                    var versions = [ "MSXML2.XMLHttp.6.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp"],
                    i, len;
                    for (i = 0,len=versions.length;i<len;i++){
                        try {
                            // new ActiveXObject(versions[i]);
                            arguments.callee.activeXString = versions[i];
                            break;
                        } catch(ex) {}
                    }
                }
                return new ActiveXObject(arguments.callee.activeXString);
            } else {
                throw new Error("No XHR object available");
            }
        }
        var xhr = new createXHR();
        // xhr.open('POST', 'http://api.no1im.com/base/online/banner/list',false);
        // xhr.send(null);//这次是一次同步请求
        // if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
        //     console.log(xhr.responseText);
        // } else {
        //     console.log("Request was unsuccessful " + xhr.status);
        // }

        // 异步请求,这里用DOM0级事件是考虑到兼容问题
        xhr.onreadystatechange = function() {
            console.log('onready',xhr.readyState)
            // readyState状态：0-未初始化，1-启动，已经调用open，2-发动，已经调用send，
            // 3-接收，已经接收到部分相应数据，4-完成，已经接收到全部相应数据
            if (xhr.readyState == 4) {
                var myHeader = xhr.getResponseHeader('Content-Length');
                var allHeader = xhr.getAllResponseHeaders();
                console.log('获取请求头', allHeader);
                if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
                    console.log(xhr.responseText);
                } else {
                    console.log("Request was unsuccessful:" + xhr.status);
                }
            }
        }
        // 第三个参数，false表示同步，true表示异步
        xhr.open('POST', 'http://api.no1im.com/base/online/banner/list',true);
        xhr.setRequestHeader('MyHeader', 'MyValue');//设置请求头
        xhr.send(null);
        // 取消请求
        // xhr.abort();
        
    </script>
</body>
</html>